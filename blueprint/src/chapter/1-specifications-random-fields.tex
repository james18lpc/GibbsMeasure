\chapter{Specifications of random fields}

Let $S$ be a set, $(E, \mathcal{E})$ be a measurable space and $\nu$ a measure on $E$.

\begin{definition}[Specification]
    \label{def:specification}
    \uses{def:cylinder-event, def:kernel}
    \lean{Specification}
    \leanok

    A {\bf specification} is a family of kernels $\gamma : \Finset S \to \Ker_{\mathcal{F}_{S\setminus\Lambda}, \mathcal{E}^S}$ which is {\bf consistent}, in the sense that
    $$\forall \Lambda_1, \Lambda_2 \in \Finset(S), \Lambda_1 \subseteq \Lambda_2 \implies \gamma_{\Lambda_1} \circ_k \gamma_{\Lambda_2} = \gamma_{\Lambda_2}$$
\end{definition}

All specifications will be with parameter set $S$ and state space $(E, \mathcal{E})$ in this chapter.

\begin{definition}[Markov Specification]
    \label{def:markov-specification}
    \lean{Specification.IsMarkov}
    \leanok
    \uses{def:specification}

    A specification $\gamma$ is a \textbf{Markov specification} if $\gamma_\Lambda$ is a probability kernel for every $\Lambda \in \Finset(S)$.
\end{definition}

\begin{definition}[Proper Specification]
    \label{def:proper-specification}
    \uses{def:specification, def:proper-kernel}
    \lean{Specification.IsProper}
    \leanok

    A specification $\gamma$ is \textbf{proper} if the kernel $\gamma_\Lambda$ is proper for every $\Lambda \in \Finset(S)$.
\end{definition}

\begin{definition}[Gibbs Measures]
    \label{def:gibbs-measure}
    \uses{def:specification}
    \lean{Specification.IsGibbsMeasure}
    \leanok
    Given a specification $\gamma$, the set of \textbf{Gibbs measures specified by $\gamma$} is defined as
    \begin{align}
        \mathcal{G}:\Gamma_{\mathcal{E}, S}&\to\text{Set}(\mathfrak{P}(E^S, \mathcal{E}^S))\\
        \gamma&\mapsto\left\{\nu\in\mathfrak{M}(E^S, \mathcal{E}^S)~\middle\vert~\gamma_\Lambda(A\mid\cdot)~\text{is a conditional expectation kernel w.r.t }\nu\text{ for each } A\in\mathcal{E}^S\text{ and }\Lambda\in\Finset(S)\right\}
    \end{align}
\end{definition}


\begin{lemma}[Characterization of Gibbs Measures]
    \label{lem:gibbs-measure-char}
    \uses{def:gibbs-measure, def:proper-specification}

    Let $\gamma$ be a {\it proper} specification with parameter set $S$ and state space $(E, \mathcal{E})$, and let $\nu\in\mathfrak{P}(E^S, \mathcal{E}^S)$. TFAE:
    \begin{enumerate}
        \item $\nu\in\mathcal{G}(\gamma)$.
        \item $\gamma_\Lambda\circ_k\nu=\nu$ for all $\Lambda\in\Finset(S)$.
        \item There is a cofinal subset $\mathcal{S}\subseteq\Finset(S)$ such that $\gamma_\Lambda\circ_k\nu=\nu$ for all $\Lambda\in\mathcal{S}$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    % \leanok

  See book.
\end{proof}

\begin{definition}[Independent Specification with Single Spin Distribution [ISSSD]]
    \label{def:ISSSD}
    \uses{def:juxtaposition}
    \lean{Specification.isssdFun}
    % \leanok

    The \textbf{Independent Specification with Single Spin Distribution $\nu$} is
    \begin{align}
        \ISSSD:\mathfrak{P}(E, \mathcal{E})&\to\Finset(S)\to\mathcal{E}^S\times E^S\to\overline{\mathbb{R}_{\geq0}}\\
        \nu&\mapsto\Lambda\mapsto(A\mid\omega)\mapsto\left(\nu^\Lambda\left(\juxtBy{\omega}^{-1}(A)\right)\right)
    \end{align}
    defines the \textbf{Independent Specification with Single Spin Distribution with $\nu$} (for each $\nu\in\mathfrak{P}(E, \mathcal{E})$), where $\nu^\Lambda$ is the usual product measure.
\end{definition}

\begin{lemma}[Strong Consistency of ISSSDs]
    \label{lem:isssd-strong-consistency}
    \uses{def:ISSSD}
    \lean{Specification.isssdFun_comp_isssdFun}
    \leanok

    $\ISSSD(\nu)$ is {\bf strongly consistent}, in the sense that
    $$\ISSSD(\nu)_{\Lambda_1} \circ_k \ISSSD(\nu)_{\Lambda_2} = \ISSSD(\nu)_{\Lambda_1 \cup \Lambda_2}$$
    for all $\Lambda_1, \Lambda_2 \in \Finset(S)$.
\end{lemma}
\begin{proof}
    % \leanok

  Immediate.
\end{proof}

\begin{definition}[ISSSDs are Specifications]
    \label{def:isssd-specification}
    \uses{lem:isssd-strong-consistency, def:specification}
    \lean{Specification.isssd}
    \leanok

    $\ISSSD(\nu)$ is a specification.
\end{definition}

\begin{lemma}[ISSSDs are Proper Specifications]
    \label{lem:isssd-proper-specification}
    \uses{def:isssd, def:proper-specification}
    \lean{Specification.IsProper.isssd}
    \leanok

    $\ISSSD(\nu)$ is a proper specification.
\end{lemma}
\begin{proof}
    \uses{def:isssd-specification}
    % \leanok

    We already know it's a specification. Properness is immediate.
\end{proof}

\begin{lemma}[Uniqueness of a Gibbs Measure Specified by an ISSSD]
    \label{lem:isssd-gibbs-measure-uniqueness}
    \uses{def:gibbs-measure, def:isssd-specification}

    There is at most one Gibbs measure specified by $\ISSSD(\nu)$.
\end{lemma}
\begin{proof}
    \uses{lem:isssd-proper-specification}
    % \leanok

    See book.
\end{proof}

\begin{lemma}[Existence of a Gibbs Measure Specified by an ISSSD]
    \label{lem:isssd-gibbs-measure-existence}
    \uses{def:gibbs-measure, def:product-probability-measure, def:isssd-specification}
    \lean{Specification.isGibbsMeasure_isssd_productMeasure}
    % \leanok

    The product measure $\nu^S$ is a Gibbs measure specified by $\ISSSD(\nu)$.
\end{lemma}
\begin{proof}
    % \leanok

   Immediate.
\end{proof}

\begin{definition}[Modification]
    \label{def:modification}
    \uses{def:specification}
    \lean{Specification.IsModification, Specification.modified}
    \leanok

    A {\bf modification of $\gamma$} is a family
    $$\rho : \Finset(S) \to \Omega \to [0, \infty[$$
    such that the corresponding family of kernels $\rho\nu$ is a specification.
\end{definition}

\begin{lemma}[Modification of a modification]
    \label{lem:modification-modification}
    \uses{def:modification}
    \lean{Specification.modified_modified}
    \leanok

    Modifying a specification $\gamma$ by $\rho_1$ then $\rho_2$ is the same as modifying it by their product.
\end{lemma}
\begin{proof}
    % \uses{}
    % \leanok

    TODO for James ;)
\end{proof}

% Currently skipping the definition of positive modifications because it looks a bit dumb

% Start of Remark 1.28.1
\begin{lemma}[A modification of a proper specification is proper]
    \label{lem:modification-proper}
    \uses{def:modification, def:proper-specification}
    \lean{Specification.IsProper.modified}
    \leanok

    If $\gamma$ is a specification and $\rho$ a modification of $\gamma$, then $\rho\gamma$ is a proper specification.
\end{lemma}
\begin{proof}
    \uses{lem:proper-kernel-integral}
    \leanok

    For all $\Lambda \in \Finset(S)$, $A \in \mathcal E^S$, $B \in \mathcal{F}_{S\setminus\Lambda}$, $\eta : S \to E$, we want to prove
    $$(\rho\gamma)_\Lambda(A \inter B | \eta) = 1_B(\eta) (\rho\gamma)_\Lambda(A B | \eta)$$
    Expanding out, this is equivalent to
    $$\int_{\zeta \in A \inter B} \rho_\Lambda(\zeta)\ d(\gamma_\Lambda(\eta)) = 1_B(\eta) \int_{\zeta \in A} \rho_\Lambda(\zeta)\ d(\gamma_\Lambda(\eta))$$
    which is true by Lemma \ref{lem:proper-kernel-integral} with $f = 1_A\rho_\Lambda$, $g = 1_B$.
\end{proof}

% The rest of Remark 1.28.1 is vacuous in our setup

% (Yaël) Don't understand Remark 1.28.2. Can it be generalised away from ISSSD?

% (Yaël) Not sure how to generalise Remark 1.28.3 away from ISSSD

% We can't state Remark 1.28.4 since we don't have a characteristic for a specification to be a
% modification of another measure

% Remark 1.28.5
\begin{lemma}[Every specification is a modification of the counting measure]
    \label{lem:exists-modification-countable}
    \uses{def:modification, def:ISSSD}
    % \lean{}
    % \leanok

    If $E$ is countable, $\nu$ is the counting measure and $\gamma$ is any specification, then
    $$\rho_\Lambda(\eta) = \gamma_\Lambda(\{\sigma_\Lambda = \eta_\Lambda\} | \eta)$$
    is a modification from $\ISSSD(\nu)$ to $\gamma$.
\end{lemma}
\begin{proof}
    % \uses{}
    % \leanok

    For all $\Lambda \in \Finset(S)$, $A$ measurable, $\eta : S \to E$, we have
    \begin{align}
        (\rho\ISSSD(\nu))_\Lambda(A|\eta)
        & = \int_\zeta \rho_\Lambda(\zeta) \ISSSD(d\zeta|\eta) \\
        & = \int_\zeta \gamma_\Lambda(\{\sigma_\Lambda = \eta_\Lambda\} | \eta) \ISSSD(d\zeta|\eta) \\
        & = \gamma_\Lambda(A|\eta)
    \end{align}
\end{proof}

% Proposition 1.30
\begin{proposition}[Characterisation of modifications]
    \label{prop:modification-tfae}
    \uses{def:modification}
    % \lean{}
    % \leanok

    If $\rho$ is a family of measurable densities, then TFAE
    \begin{enumerate}
        \item $\rho$ is a modification of $\gamma$
        \item For all $\Lambda_1, \Lambda_2$ with $\Lambda_1 \subseteq \Lambda_2$ and all $\eta : S \to E$, we have
        $$\rho_{\Lambda_2} = \rho_{\Lambda_1} \gamma_{\Lambda_1} \rho_{\Lambda_2} \quad \gamma_{\Lambda_2}(\cdot|\eta)\text{ae}$$
        \item For all $\Lambda_1, \Lambda_2$ with $\Lambda_1 \subseteq \Lambda_2$ and all $\alpha : S \to E$, then for all $\gamma_{\Lambda_2 \setminus \Lambda_1}(\cdot|\alpha)$-almost all $\omega : S \to E$, we have
        $$\rho_{\Lambda_2}(\zeta)\rho_{\Lambda_1}(\eta) = \rho_{\Lambda_2}(\eta) \rho_{\Lambda_1}(\zeta)$$
        for $\nu_{\Lambda_1}(\cdot|\omega) \times \nu_{\Lambda_2}(\cdot|\omega)$-almost all $(\zeta, \lambda)$.
    \end{enumerate}
\end{proposition}
\begin{proof}
    % \uses{}
    % \leanok

    TODO
\end{proof}

% Definition 1.31

\begin{definition}[Premodification]
    \label{def:premodification}
    % \uses{}
    % \lean{}
    % \leanok

    A family of functions $h_\Lambda : (S \to E) \to [0, \infty[$ is a {\bf premodification} if
    $$h_{\Lambda_2}(\zeta)h_{\Lambda_1}(\eta) = h_{\Lambda_1}(\zeta)h_{\Lambda_2}(\eta)$$
    for all $\Lambda_1 \subseteq \Lambda_2$ and all $\zeta, \eta : S \to E$ such that $\zeta_{\Lambda_1^c} = \eta_{\Lambda_1^c}$.
\end{definition}

% TODO: Probably split into several items
% Note that we do not need this result. This is just for fun.
\begin{lemma}[Modifications are premodifications]
    \label{lem:modification-premodification}
    \uses{def:modification, def:premodification}
    % \lean{}
    % \leanok
    If $\rho$ is a modification of $\ISSSD(\nu^S)$, then it is a premodification if any of the following conditions hold:
    \begin{enumerate}
        \item $E$ is countable and $\nu$ is equivalent to the counting measure.
        \item $E$ is a second countable Borel space.
        \item $\nu$ is everywhere dense.
        \item For all $\Lambda_1 \subseteq \Lambda_2$ and all $\eta : S \to E$, $\zeta \mapsto \rho_{\Lambda_1}(\zeta \eta_{\Lambda_1^c})$ is continuous on $E^{\Lambda_1}$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    \uses{prop:modification-tfae}
    % \leanok

    \begin{enumerate}
        \item Use Proposition \ref{prop:modification-tfae}.
        \item Omitted.
        \item Omitted.
        \item Omitted.
    \end{enumerate}
\end{proof}

% Remark 1.32
\begin{lemma}[Premodifications give rise to modifications]
    \label{lem:premodification-modification}
    \uses{def:modification, def:premodification}

    If $h$ is a premodification and $\nu$ is such that $0 < \nu_\Lambda h_\Lambda < \infty$ for all $\Lambda$, then
    $$\rho_\Lambda := \frac{h_\Lambda}{\nu_\Lambda h_\Lambda}$$
    is a modification of $\ISSSD(\nu)$.
\end{lemma}
\begin{proof}
    \uses{prop:modification-tfae}

    TODO
\end{proof}

% Skipping Theorem 1.33 for now
